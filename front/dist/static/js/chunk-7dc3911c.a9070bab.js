(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7dc3911c"],{"5cf7":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"form",attrs:{model:t.projectInfo,"label-width":"120px"}},[a("el-form-item",["readonly"===t.readStatus?a("el-button",{attrs:{type:"primary"},on:{click:t.handleUpdataForm}},[t._v("修改")]):t._e(),""===t.readStatus?a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmitUpdata}},[t._v("确定")]):t._e(),""===t.readStatus?a("el-button",{attrs:{type:"primary"},on:{click:t.cancelModification}},[t._v("取消")]):t._e(),1===this.projectInfo.status?a("el-button",{attrs:{type:"warning"},on:{click:t.onclickStopProject}},[t._v("停止招标")]):t._e(),2===this.projectInfo.status?a("el-button",{attrs:{type:"primary"},on:{click:t.onclickStartProject}},[t._v("开始招标")]):t._e(),a("el-button",{attrs:{type:"danger"},on:{click:t.onclickDeleteProject}},[t._v("删除")])],1),a("el-form-item",{attrs:{label:"项目编号"}},[a("el-input",{attrs:{readonly:"readonly"===t.readStatus},model:{value:t.projectInfo.projectId,callback:function(e){t.$set(t.projectInfo,"projectId",e)},expression:"projectInfo.projectId"}})],1),a("el-form-item",{attrs:{label:"项目名称"}},[a("el-input",{attrs:{readonly:"readonly"===t.readStatus},model:{value:t.projectInfo.projectName,callback:function(e){t.$set(t.projectInfo,"projectName",e)},expression:"projectInfo.projectName"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{readonly:"readonly"===t.readStatus,type:"textarea"},model:{value:t.projectInfo.addition,callback:function(e){t.$set(t.projectInfo,"addition",e)},expression:"projectInfo.addition"}})],1),a("el-form-item",[""===t.readStatus?a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.addParamsSetting}},[t._v("新增包件")]):t._e()],1),a("el-form-item",{attrs:{label:"包件信息"}},[a("el-table",{staticClass:"list-table",staticStyle:{width:"100%"},attrs:{data:t.updateData.packageList,size:"mini",border:""}},[a("el-table-column",{attrs:{prop:"index",label:"序号",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form-item",[t._v(" "+t._s(e.$index+1)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"packageName",label:"包件名称",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form-item",{attrs:{label:"",prop:"form.tableData."+e.$index+".packageName",rules:[{required:!0,message:"包件名称不可为空",trigger:"change"}]}},[a("el-input",{attrs:{readonly:"readonly"===t.readStatus,placeholder:"请输入包件名称"},model:{value:e.row.packageName,callback:function(a){t.$set(e.row,"packageName",a)},expression:"scope.row.packageName"}})],1)]}}])}),a("el-table-column",{attrs:{prop:"price",label:"招标文件费",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form-item",{attrs:{label:"",prop:"form.tableData."+e.$index+".price",rules:[{required:!0,message:"招标文件费不可为空",trigger:"change"}]}},[a("el-input",{attrs:{readonly:"readonly"===t.readStatus,placeholder:"请输入招标文件费"},on:{keyup:function(e){t.value=t.value.replace(/[^\d]/g,"")},blur:function(e){t.value=t.value.replace(/[^\d]/g,"")}},model:{value:e.row.price,callback:function(a){t.$set(e.row,"price",a)},expression:"scope.row.price"}},[a("template",{slot:"append"},[t._v("元")])],2)],1)]}}])}),a("el-table-column",{attrs:{prop:"startTime",label:"开始时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form-item",{attrs:{label:"",prop:"form.tableData."+e.$index+".startTime",rules:[{required:!0,message:"开始时间不可为空",trigger:"change"}]}},[a("el-date-picker",{attrs:{readonly:"readonly"===t.readStatus,type:"datetime",placeholder:"选择开始时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.row.startTime,callback:function(a){t.$set(e.row,"startTime",a)},expression:"scope.row.startTime"}})],1)]}}])}),a("el-table-column",{attrs:{prop:"endTime",label:"结束时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form-item",{attrs:{label:"",prop:"form.tableData."+e.$index+".endTime",rules:[{required:!0,message:"结束时间不可为空",trigger:"change"}]}},[a("el-date-picker",{attrs:{readonly:"readonly"===t.readStatus,type:"datetime",placeholder:"选择结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.row.endTime,callback:function(a){t.$set(e.row,"endTime",a)},expression:"scope.row.endTime"}})],1)]}}])}),a("el-table-column",{attrs:{prop:"filePath",label:"招标文件",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form-item",{attrs:{label:"",prop:"form.tableData."+e.$index+".fileList",rules:[{required:!0,message:"招标文件不可为空",trigger:"change"}]}},[""===t.readStatus?a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"http://localhost:8089","on-change":function(a,r){t.handleChange(a,r,e.$index)},"on-preview":t.handlePreview,"on-remove":function(a,r){t.handleRemove(a,r,e.$index)},limit:2,"auto-upload":!1}},[t._v(" 选取文件 ")]):t._e(),"readonly"===t.readStatus?a("p",[t._v(t._s(e.row.fileName))]):t._e()],1)]}}])}),""===t.readStatus?a("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index)}}},[t._v("删除")])]}}],null,!1,3395820834)}):t._e()],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.downloadOrderExcel}},[t._v("投标信息下载")])],1),a("el-form-item",{attrs:{label:"投标信息"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.orderList,"row-class-name":t.tableRowClassName}},[a("el-table-column",{attrs:{prop:"index",label:"序号",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.$index+1)+" ")]}}])}),a("el-table-column",{attrs:{prop:"orderPeopleName",label:"投标联系人姓名",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" ")]}}])}),a("el-table-column",{attrs:{prop:"orderPeoplePhone",label:"投标联系人电话"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.phoneNum)+" ")]}}])}),a("el-table-column",{attrs:{prop:"unitName",label:"投标单位"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.unitName)+" ")]}}])}),a("el-table-column",{attrs:{prop:"total",label:"总金额（元）"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.total)+" ")]}}])}),a("el-table-column",{attrs:{prop:"downloadStatus",label:"已下载包件",filters:[{text:"否",value:0},{text:"是",value:1}],"filter-method":t.filterDownload},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.downloadStatus?a("el-tag",{key:"否",attrs:{type:"danger",effect:"dark"}},[t._v(" 否 ")]):t._e(),1===e.row.downloadStatus?a("el-tag",{key:"是",attrs:{type:"success",effect:"dark"}},[t._v(" 是 ")]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"status",label:"订单状态",width:"150",filters:[{text:"待付款",value:0},{text:"已付款",value:1},{text:"已完成",value:2},{text:"已失效",value:3},{text:"未通过",value:4}],"filter-method":t.filterStatus},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.status?a("el-tag",{key:"待付款",attrs:{type:"warning",effect:"dark"}},[t._v(" 待付款 ")]):t._e(),1===e.row.status?a("el-tag",{key:"已付款",attrs:{type:"primary",effect:"dark"}},[t._v(" 已付款 ")]):t._e(),2===e.row.status?a("el-tag",{key:"已完成",attrs:{type:"success",effect:"dark"}},[t._v(" 已完成 ")]):t._e(),3===e.row.status?a("el-tag",{key:"已失效",attrs:{type:"info",effect:"dark"}},[t._v(" 已失效 ")]):t._e(),4===e.row.status?a("el-tag",{key:"未通过",attrs:{type:"danger",effect:"dark"}},[t._v(" 未通过 ")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.onclickOrderDetails(e.row)}}},[t._v("查看详情")])]}}])})],1),a("div",{staticClass:"block"},[a("el-pagination",{staticStyle:{padding:"30px 0","text-align":"center"},attrs:{"current-page":t.page,"page-sizes":[5,10,20,50],"page-size":t.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)],1)},o=[],n=a("c7eb"),i=a("1da1"),l=(a("a434"),a("a9e3"),a("b775"));function s(t){return Object(l["a"])({url:"/api/project/getProjectById",method:"post",data:t})}function c(t,e,a){return Object(l["a"])({url:"/api/order/getOrderList/"+t+"/"+e,method:"post",data:a})}function u(t){return Object(l["a"])({url:"/api/project/stopProject/"+t,method:"post"})}function d(t){return Object(l["a"])({url:"/api/project/startProject/"+t,method:"post"})}function p(t){return Object(l["a"])({url:"/api/project/deleteProject/"+t,method:"post"})}function f(t){return Object(l["a"])({url:"/api/project/getOrderPackageCount/"+t,method:"post"})}var m=a("ad8f"),h=a("c1df"),g=a.n(h),b={data:function(){return{queryData:{id:0},projectInfo:null,orderQueryData:{username:"",id:0},orderList:null,page:1,limit:5,total:0,readStatus:"readonly",fileList:[],updateData:{projectName:"",addition:"",packageList:[],status:[],projectId:""}}},created:function(){this.queryData.id=this.$route.params.id,this.orderQueryData.id=this.$route.params.id,this.getProjectDetails(),this.getOrderListPage()},methods:{getProjectDetails:function(){var t=this;return Object(i["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.listLoading=!0,e.next=3,s(t.queryData).then((function(e){t.projectInfo=e.data,t.updateData.packageList=e.data.packageList;for(var a=t.updateData.packageList.length,r=0;r<a;r++)t.$set(t.updateData.packageList[r],"startTime",new Date(t.updateData.packageList[r].startTime)),t.$set(t.updateData.packageList[r],"endTime",new Date(t.updateData.packageList[r].endTime)),t.updateData.status.push(2),t.fileList.push({});t.listLoading=!1}));case 3:case"end":return e.stop()}}),e)})))()},getOrderListPage:function(){var t=this;c(this.page,this.limit,this.orderQueryData).then((function(e){t.orderList=e.data.records,t.total=e.data.total}))},handleSizeChange:function(t){this.limit=t,this.getOrderListPage(),console.log("每页 ".concat(t," 条"))},handleCurrentChange:function(t){this.page=t,this.getOrderListPage(),console.log("当前页: ".concat(t))},handleUpdataForm:function(){this.readStatus=""},handleSubmitUpdata:function(){var t=this;return Object(i["a"])(Object(n["a"])().mark((function e(){var a,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.readStatus="readonly",t.updateData.projectId=t.projectInfo.id,t.updateData.projectName=t.projectInfo.projectName,t.updateData.addition=t.projectInfo.addition,t.updateData.id=t.projectInfo.projectId,a=0;case 6:if(!(a<t.fileList.length)){e.next=18;break}if(t.updateData.packageList[a].startTime=g()(new Date(t.updateData.packageList[a].startTime)).format("YYYY-MM-DD HH:mm:ss"),t.updateData.packageList[a].endTime=g()(new Date(t.updateData.packageList[a].endTime)).format("YYYY-MM-DD HH:mm:ss"),2!==t.updateData.status[a]){e.next=11;break}return e.abrupt("continue",15);case 11:return r=new FormData,r.append("file",t.fileList[a].raw),e.next=15,Object(m["b"])(r).then((function(e){"success"===e.message?(t.updateData.packageList[a].filePath=e.data.filePath,t.updateData.packageList[a].fileName=e.data.fileName):a-=1}));case 15:a++,e.next=6;break;case 18:Object(m["d"])(t.updateData).then((function(e){t.$message.success("更新成功！"),t.$router.push({name:"project_details",params:{id:t.projectInfo.id}})}));case 19:case"end":return e.stop()}}),e)})))()},cancelModification:function(){this.$router.go(0)},onclickStopProject:function(){var t=this;u(this.projectInfo.id).then((function(e){console.log(e),t.$router.go(0)}))},onclickStartProject:function(){var t=this;d(this.projectInfo.id).then((function(e){console.log(e),t.$router.go(0)}))},onclickDeleteProject:function(){var t=this;p(this.projectInfo.id).then((function(e){t.$router.push("/table"),console.log(e)}))},onclickOrderDetails:function(t){this.$router.push({name:"order_details",params:{id:t.id}})},addList:function(){this.updateData.packageList.push({id:"",fileName:"",filePath:"",packageName:"",price:"",projectId:this.projectInfo.id,startTime:"",endTime:""}),this.updateData.status.push(2),this.fileList.push({})},addParamsSetting:function(){this.addList()},deleteRow:function(t){var e=this;f(this.updateData.packageList[t].id).then((function(a){a.data>0?e.$message.error({message:"该包件已被购买，无法删除！",toString:function(){return e.message}}):(e.updateData.packageList.splice(t,1),e.updateData.status.splice(t,1),e.fileList.splice(t,1))}))},handleChange:function(t,e,a){var r=Number(t.size/1024/1024);if(r>2048)return this.$message.warning("文件大小不能超过2GB，请重新上传。"),void e.splice(e.length-1,1);while(e.length>1)e.splice(0,1);t&&(this.fileList[a]=e[e.length-1],""===this.updateData.packageList[a].filePath?this.updateData.status[a]=0:this.updateData.status[a]=1)},handleRemove:function(t,e,a){this.fileList[a]={}},handlePreview:function(t){console.log(t)},downloadOrderExcel:function(){var t="https://www.huaskj.com/bidding-be-api//api/order/downloadOrderList/"+this.projectInfo.id,e=document.createElement("a");e.href=t,e.click()},filterDownload:function(t,e){return e.downloadStatus===t},filterStatus:function(t,e){return e.status===t}}},k=b,y=a("2877"),j=Object(y["a"])(k,r,o,!1,null,"498f0b37",null);e["default"]=j.exports},a434:function(t,e,a){"use strict";var r=a("23e7"),o=a("23cb"),n=a("a691"),i=a("50c4"),l=a("7b0b"),s=a("65f0"),c=a("8418"),u=a("1dde"),d=a("ae40"),p=u("splice"),f=d("splice",{ACCESSORS:!0,0:0,1:2}),m=Math.max,h=Math.min,g=9007199254740991,b="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!p||!f},{splice:function(t,e){var a,r,u,d,p,f,k=l(this),y=i(k.length),j=o(t,y),w=arguments.length;if(0===w?a=r=0:1===w?(a=0,r=y-j):(a=w-2,r=h(m(n(e),0),y-j)),y+a-r>g)throw TypeError(b);for(u=s(k,r),d=0;d<r;d++)p=j+d,p in k&&c(u,d,k[p]);if(u.length=r,a<r){for(d=j;d<y-r;d++)p=d+r,f=d+a,p in k?k[f]=k[p]:delete k[f];for(d=y;d>y-r+a;d--)delete k[d-1]}else if(a>r)for(d=y-r;d>j;d--)p=d+r-1,f=d+a-1,p in k?k[f]=k[p]:delete k[f];for(d=0;d<a;d++)k[d+j]=arguments[d+2];return k.length=y-r+a,u}})},ad8f:function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return i})),a.d(e,"d",(function(){return l})),a.d(e,"b",(function(){return s}));var r=a("b775"),o="/api/project";function n(t,e,a){return Object(r["a"])({url:o+"/projectListByLimit/"+t+"/"+e,method:"post",data:a})}function i(t){return Object(r["a"])({url:o+"/addProject",method:"post",data:t})}function l(t){return Object(r["a"])({url:o+"/updateProject",method:"post",data:t})}function s(t){return Object(r["a"])({url:o+"/addProjectFile",method:"post",headers:{"Content-Type":"multipart/form-data;charset=utf-8"},data:t})}}}]);